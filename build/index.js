function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function c(){return t=" ",document.createTextNode(t);var t}let u;function f(t){u=t}function l(t){(function(){if(!u)throw new Error("Function called outside component initialization");return u})().$$.on_mount.push(t)}const d=[],p=[],m=[],g=[],h=Promise.resolve();let $=!1;function w(t){m.push(t)}let y=!1;const x=new Set;function b(){if(!y){y=!0;do{for(let t=0;t<d.length;t+=1){const e=d[t];f(e),_(e.$$)}for(d.length=0;p.length;)p.pop()();for(let t=0;t<m.length;t+=1){const e=m[t];x.has(e)||(x.add(e),e())}m.length=0}while(d.length);for(;g.length;)g.pop()();$=!1,y=!1,x.clear()}}function _(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const v=new Set;function I(t,e){-1===t.$$.dirty[0]&&(d.push(t),$||($=!0,h.then(b)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function k(a,s,c,l,d,p,m=[-1]){const g=u;f(a);const h=s.props||{},$=a.$$={fragment:null,ctx:null,props:p,update:t,not_equal:d,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(g?g.$$.context:[]),callbacks:n(),dirty:m};let y=!1;if($.ctx=c?c(a,h,(t,e,...n)=>{const o=n.length?n[0]:e;return $.ctx&&d($.ctx[t],$.ctx[t]=o)&&($.bound[t]&&$.bound[t](o),y&&I(a,t)),e}):[],$.update(),y=!0,o($.before_update),$.fragment=!!l&&l($.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);$.fragment&&$.fragment.l(t),t.forEach(i)}else $.fragment&&$.fragment.c();s.intro&&((x=a.$$.fragment)&&x.i&&(v.delete(x),x.i(_))),function(t,n,a){const{fragment:s,on_mount:i,on_destroy:c,after_update:u}=t.$$;s&&s.m(n,a),w(()=>{const n=i.map(e).filter(r);c?c.push(...n):o(n),t.$$.on_mount=[]}),u.forEach(w)}(a,s.target,s.anchor),b()}var x,_;f(g)}function A(e){let n,o;return{c(){var t;n=c(),t="chat-widget",o=document.createElement(t),document.title="Koschei Society"},m(t,r){s(t,n,r),s(t,o,r),e[1](o)},p:t,i:t,o:t,d(t){t&&i(n),t&&i(o),e[1](null)}}}function E(t,e,n){let o;return l(()=>{(async t=>{let e,n="",o={},r=[];const a=await window.fetch("./dialogue.json"),s=await a.json(),{defaultSleepFor:i,defaultSleepBefore:c,variables:u}=s,{parse:f,stringify:l}=JSON,d=()=>f(l(s.textItems)),p=t=>0===t?Promise.resolve():new Promise(e=>{setTimeout(e,1e3*t)}),m=()=>new Promise(t=>{e=t}),g=t=>{let e;return"$"===t[0]?(t=t.slice(1),e=s.textItems.findIndex(e=>{const n=e[t],r=o[t];return n&&n.includes(r)})):e=s.textItems.findIndex(e=>e.key===t),e>0?(console.log(d().slice(e)),d().slice(e)):d()},h=async e=>{const{text:a,info:u=!1,image:f,sleepFor:l=i,sleepBefore:d=c,saveInputAs:$,saveVariable:w,waitFor:y=[],conditionals:x=[],waitForAnyInput:b=!1,defaultResponses:_=s.defaultResponses,goto:v}=e;if((a||f)&&(console.log("start"),t.startMessage({info:u,user:!1})),await p(d),a){let e=a;for(const[t,n]of Object.entries(o))e=e.replace(`{${t}}`,n);console.log("commit"),t.commitMessage(e)}for(f&&t.commitImage(f),$&&(n?(o[$]=n,n=""):o[$]=await m()),w&&(o={...o,...w});y.length>0;){let t,e="";n?(e=n,n=""):e=await m();for(const n of y){if(t)break;for(const r of n.acceptedInputs){if(e.replace(/\s\s+/g," ").toLowerCase().includes(r.toLowerCase())){t=n,!0!==t.continue&&y.splice(y.indexOf(n),1),n.saveInputAs&&(o[n.saveInputAs]=e.toLowerCase(),delete n.saveInputAs);break}}}if(t){if(await h(t),t.break)break}else{const t=Math.random()*_.length|0;await h(_[t])}}b&&await m();for(const t of x){const{variableEquals:e}=t,[n,r]=e;if(o[n]===r){await h(t);break}}return await p(l),!!v&&(r=g(v),!0)};t.addEventListener("userinput",t=>{e?e(t.detail):n=t.detail}),s.textItems=f(l(s.textItems,(t,e)=>{if(!Array.isArray(e))return e;for(const[t,n]of Object.entries(u))e.includes(t)&&(e.splice(e.indexOf(t),1),e=[...e,...n]);return e})),r=s.debugJumpTo?g(s.debugJumpTo):d(),(async()=>{for(;r.length>0;)await h(r.shift())})()})(o)}),[o,function(t){p[t?"unshift":"push"](()=>{n(0,o=t)})}]}export default class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}{constructor(t){super(),k(this,t,E,A,a,{})}}
