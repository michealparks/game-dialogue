function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function c(){return t=" ",document.createTextNode(t);var t}let u;function f(t){u=t}function l(t){(function(){if(!u)throw new Error("Function called outside component initialization");return u})().$$.on_mount.push(t)}const d=[],p=[],h=[],m=[],g=Promise.resolve();let $=!1;function w(t){h.push(t)}let y=!1;const b=new Set;function _(){if(!y){y=!0;do{for(let t=0;t<d.length;t+=1){const e=d[t];f(e),v(e.$$)}for(d.length=0;p.length;)p.pop()();for(let t=0;t<h.length;t+=1){const e=h[t];b.has(e)||(b.add(e),e())}h.length=0}while(d.length);for(;m.length;)m.pop()();$=!1,y=!1,b.clear()}}function v(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const x=new Set;function k(t,e){-1===t.$$.dirty[0]&&(d.push(t),$||($=!0,g.then(_)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function A(s,i,c,l,d,p,h=[-1]){const m=u;f(s);const g=i.props||{},$=s.$$={fragment:null,ctx:null,props:p,update:t,not_equal:d,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(m?m.$$.context:[]),callbacks:n(),dirty:h,skip_bound:!1};let y=!1;if($.ctx=c?c(s,g,(t,e,...n)=>{const o=n.length?n[0]:e;return $.ctx&&d($.ctx[t],$.ctx[t]=o)&&(!$.skip_bound&&$.bound[t]&&$.bound[t](o),y&&k(s,t)),e}):[],$.update(),y=!0,o($.before_update),$.fragment=!!l&&l($.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);$.fragment&&$.fragment.l(t),t.forEach(a)}else $.fragment&&$.fragment.c();i.intro&&((b=s.$$.fragment)&&b.i&&(x.delete(b),b.i(v))),function(t,n,s){const{fragment:i,on_mount:a,on_destroy:c,after_update:u}=t.$$;i&&i.m(n,s),w(()=>{const n=a.map(e).filter(r);c?c.push(...n):o(n),t.$$.on_mount=[]}),u.forEach(w)}(s,i.target,i.anchor),_()}var b,v;f(m)}const E=t=>0===t?Promise.resolve():new Promise(e=>{setTimeout(e,1e3*t)}),I=(t,e)=>{const n=Object.entries(e);return JSON.parse(JSON.stringify(t),(t,e)=>{if(!Array.isArray(e))return e;for(const[t,o]of n){const n=e.indexOf(t);-1!==n&&(e.splice(n,1),e=[...e,...o])}return e})};function O(e){let n,o;return{c(){var t;n=c(),t="chat-widget",o=document.createElement(t),document.title="Koschei Society"},m(t,r){i(t,n,r),i(t,o,r),e[1](o)},p:t,i:t,o:t,d(t){t&&a(n),t&&a(o),e[1](null)}}}function j(t,e,n){let o;return l(()=>{(async t=>{let e,n=!1,o="",r={},s=0;const i=await window.fetch("./dialogue.json"),a=await i.json(),c=new URLSearchParams(window.location.search).get("debug"),{bot:u,dialogue:f,variables:l}=a,d=()=>{if(o){const t=""+o;return o="",Promise.resolve(t)}return new Promise(t=>{e=t})},p=t=>{"$"===t[0]?(t=t.slice(1),s=f.findIndex(e=>e[t]&&I(e[t],l).includes(r[t]))):s=f.findIndex(e=>e.key===t),n=!0},h=(t,e)=>{const n=/\s\s+/g;let o=0;for(const s of e){for(const i of s.answers){const a=t.replace(n," ").toLowerCase();if(a.includes(i.toLowerCase())){const t=s;return t.repeat||e.splice(o,1),t.saveInputAs&&(r[t.saveInputAs]=a,t.saveInputAs=void 0),t}}o+=1}},m=async e=>{const{text:n,image:o,info:s=!1,sleepBefore:i=u.sleepBefore,sleepAfter:a=u.sleepAfter,saveInputAs:c,saveVariable:f,waitFor:g=[],conditionals:$=[],waitForAnyInput:w=!1,defaultResponses:y=u.responses.incorrect,goto:b}=I(e,l);if((n||o)&&t.startMessage({info:s,user:!1}),await E(i),n){let e=n;for(const[t,n]of Object.entries(r))e=e.replace(`{${t}}`,n);t.commitMessage(e)}for(o&&t.commitImage(o),c&&(r[c]=await d()),w&&await d(),f&&(r={...r,...f});g.length>0;){const t=h(await d(),g);if(t){if(await m(t),t.satisfies)break}else{const t=Math.random()*y.length|0;await m(y[t])}}for(const t of $){const{variableEquals:e}=t,[n,o]=e;if(r[n]===o){await m(t);break}}await E(a),b&&p(b)};for(t.addEventListener("userinput",t=>{e?(e(t.detail),e=void 0):o+=" "+t.detail}),c&&(p(c),n=!1);s<f.length;)await m(f[s]),n?n=!1:s+=1})(o)}),[o,function(t){p[t?"unshift":"push"](()=>{o=t,n(0,o)})}]}export default class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),A(this,t,j,O,s,{})}}
