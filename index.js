function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function c(){return t=" ",document.createTextNode(t);var t}let l;function u(t){l=t}function f(t){(function(){if(!l)throw new Error("Function called outside component initialization");return l})().$$.on_mount.push(t)}const d=[],p=[],g=[],m=[],h=Promise.resolve();let $=!1;function w(t){g.push(t)}let y=!1;const b=new Set;function x(){if(!y){y=!0;do{for(let t=0;t<d.length;t+=1){const e=d[t];u(e),v(e.$$)}for(d.length=0;p.length;)p.pop()();for(let t=0;t<g.length;t+=1){const e=g[t];b.has(e)||(b.add(e),e())}g.length=0}while(d.length);for(;m.length;)m.pop()();$=!1,y=!1,b.clear()}}function v(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const _=new Set;function A(t,e){-1===t.$$.dirty[0]&&(d.push(t),$||($=!0,h.then(x)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(s,a,c,f,d,p,g=[-1]){const m=l;u(s);const h=a.props||{},$=s.$$={fragment:null,ctx:null,props:p,update:t,not_equal:d,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(m?m.$$.context:[]),callbacks:n(),dirty:g};let y=!1;if($.ctx=c?c(s,h,(t,e,...n)=>{const o=n.length?n[0]:e;return $.ctx&&d($.ctx[t],$.ctx[t]=o)&&($.bound[t]&&$.bound[t](o),y&&A(s,t)),e}):[],$.update(),y=!0,o($.before_update),$.fragment=!!f&&f($.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);$.fragment&&$.fragment.l(t),t.forEach(i)}else $.fragment&&$.fragment.c();a.intro&&((b=s.$$.fragment)&&b.i&&(_.delete(b),b.i(v))),function(t,n,s){const{fragment:a,on_mount:i,on_destroy:c,after_update:l}=t.$$;a&&a.m(n,s),w(()=>{const n=i.map(e).filter(r);c?c.push(...n):o(n),t.$$.on_mount=[]}),l.forEach(w)}(s,a.target,a.anchor),x()}var b,v;u(m)}const E=t=>0===t?Promise.resolve():new Promise(e=>{setTimeout(e,1e3*t)}),j=(t,e)=>{const n=Object.entries(e);return JSON.parse(JSON.stringify(t),(t,e)=>{if(!Array.isArray(e))return e;for(const[t,o]of n){const n=e.indexOf(t);-1!==n&&(e.splice(n,1),e=[...e,...o])}return e})};function O(e){let n,o;return{c(){var t;n=c(),t="chat-widget",o=document.createElement(t),document.title="Koschei Society"},m(t,r){a(t,n,r),a(t,o,r),e[1](o)},p:t,i:t,o:t,d(t){t&&i(n),t&&i(o),e[1](null)}}}function k(t,e,n){let o;return f(()=>{(async t=>{let e,n=!1,o="",r={},s=0;const a=await window.fetch("./dialogue.json"),i=await a.json(),c=new URLSearchParams(window.location.search).get("debug"),{bot:l,dialogue:u,variables:f}=i,d=()=>{if(console.log("missedInput: ",o),o){const t=""+o;return o="",Promise.resolve(t)}return new Promise(t=>{e=t})},p=t=>{"$"===t[0]?(t=t.slice(1),s=u.findIndex(e=>e[t]&&j(e[t],f).includes(r[t]))):s=u.findIndex(e=>e.key===t),n=!0,console.log("jump: ",s,u[s])},g=(t,e)=>{const n=/\s\s+/g;let o=0;for(const s of e){for(const a of s.answers){const i=t.replace(n," ").toLowerCase();if(i.includes(a.toLowerCase())){const t=s;return t.repeat||e.splice(o,1),t.saveInputAs&&(r[t.saveInputAs]=i,t.saveInputAs=void 0),t}}o+=1}},m=async e=>{const{text:n,image:o,info:s=!1,sleepBefore:a=l.sleepBefore,sleepAfter:i=l.sleepAfter,saveInputAs:c,saveVariable:u,waitFor:h=[],conditionals:$=[],waitForAnyInput:w=!1,defaultResponses:y=l.responses.incorrect,goto:b}=j(e,f);if(console.log("item: ",e),(n||o)&&t.startMessage({info:s,user:!1}),await E(a),n){let e=n;for(const[t,n]of Object.entries(r))e=e.replace(`{${t}}`,n);t.commitMessage(e)}for(o&&t.commitImage(o),c&&(r[c]=await d()),w&&await d(),u&&(r={...r,...u});h.length>0;){console.log("waitFor: ",h);const t=g(await d(),h);if(t){if(await m(t),t.satisfies)break}else{const t=Math.random()*y.length|0;await m(y[t])}}for(const t of $){const{variableEquals:e}=t,[n,o]=e;if(r[n]===o){await m(t);break}}await E(i),b&&p(b)};for(t.addEventListener("userinput",t=>{console.log("userInput: ",t.detail,e),e?(e(t.detail),e=void 0):o+=" "+t.detail}),c&&(p(c),n=!1);s<u.length;)await m(u[s]),console.log(n,s),n?n=!1:s+=1})(o)}),[o,function(t){p[t?"unshift":"push"](()=>{n(0,o=t)})}]}export default class extends class{$destroy(){!function(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}{constructor(t){super(),I(this,t,k,O,s,{})}}
